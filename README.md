# OpenWrt
# 树梅派4B软路由（旁路由模式） 
# 1. 背景
 - 最近一直在看软路由的视频教程，以前也尝试过很多软路由软件， 包括虚拟机软件，也买花大价钱买过专用软路由，但是一直没有尝试成功。主要是想做的方案太复杂，又想多学点知识，又想把自己会的技能的都使用出来，又想让软路由多承担点功能。简单说是完美主义，目标不清晰。
 - 最近学习到有关家庭网络和软路由的两个原则，[原视频：哪种家庭网络路由模式适合我？单臂路由和旁路由有何不同？单臂路由还是旁路由？](https://www.youtube.com/watch?v=OPG47_wT3XI) 自己再加一条，这里了引用如下：
 - a. 家庭网络拓扑结构要简单：所有的设备统一在一个网段之下，意味着只有一层NAT转换，只有一个负责的NAT设备
 - b. 所有网络控制功能都应该尽力收归到 OpenWrt 服务器
 - c. 我再加3条：成本要尽可能的低，设备要尽可能少，影响要尽可能小，这样可以减少试错成本。

# 2. 网络现状
  - 100M宽带，电信光纤，一直是这个速率，够用！
  - 网络今年已经做了不少升级，更换为1000M光猫，光猫自己折腾改成桥接模式
  - 买了 水星 1000M mesh路由器，一次买了两个，每个路由器有两个千兆网口，带wifi 2.5G/5G。千兆光猫使用桥接模式，主路由器使用拨号上网，mesh网络也配置成功，mesh网络之间使用无线链接的，网络效能稍微降低，但是我的宽带也100M，所以完全够用。网络几个客户端，电脑，电视都是无线链接的。mesh网络甚至还支持IPV6。
  - 有一台小米无线路由器，下面接的是 家里的多台小米设备。
  - 有一个5口千兆交换机在用，（还有一个8口千兆交换机闲置，备用）
  
# 3. 软路由方案
   - 硬件使用树梅派4B，有一个千兆有线网口，USB3.0接口2个，usb2.0接口2个，内存4G，sd卡16G
   - 看到网络上有关树梅派4B的测试视频，支持科学上网速度接近1000兆，所以对于我只有100M的宽带来说绰绰有余
   - 树梅派4B只有一个千兆网口，同时为了减少对现有网络的影响，决定选择旁路由模式
   - 网络拓扑结构：
   -   a）. 世界网络---> 中国电信----> 100M宽带---> 1000M光猫(桥接模式) ----> 千兆水星mesh主路由（拨号模式,wifi 2.4G/5G开启）
   -   b）. 水星mesh主路由 ---> 5口千兆水星交换机 ----> 树梅派4B(旁路由)
   -   c）. wifi----->  水星mesh从路由器  ----> wifi ------> 各个 手机和电脑设备
   -   d）. 5口水星千兆交换机 ----->  小米无线路由器 ----> 小米家庭设备若干 
   -   注释：最近获悉，小米的设备可以不用小米路由器也可以接入网络进行管理，所以下一步准备去掉小米路由器，直接接入mesh无线网

# 4. OpenWrt安装
## 0. 资源：
  看网上好几个视频都介绍  SuLingGG 的编译版本，可以用于树梅派全系列，每日自动编译更新。
  - [OpenWrt 树梅派版本 github主页](https://github.com/SuLingGG/OpenWrt-Rpi) 
  - [OpenWrt 帮助主页](https://mlapp.cn/)
  - [自编译 OpenWrt 系列 - 旁路由设置指南](https://mlapp.cn/1008.html)
  
## 1. 下载 和 SD卡烧录
  [点击进入下载页面](https://openwrt.cc/releases/targets/bcm27xx/bcm2711/)  
  下载文件： openwrt-bcm27xx-bcm2711-rpi-4-ext4-factory.img.gz  
  烧录SD卡：  
  工具：Etcher [Etcher下载页面](https://www.balena.io/etcher/?ref=etcher_footer)  
  烧录过程略...  
  
  
## 2. 连接树梅派4B
  
  
  
  
  
  
